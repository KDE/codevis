cmake_minimum_required(VERSION 3.10)

set(PLUGIN_NAME allowed_dependencies_plugin)
project(${PLUGIN_NAME})

add_custom_command(
    OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/README.md
    OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/metadata.json
    OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/${PLUGIN_NAME}.py
    COMMAND ${CMAKE_COMMAND} -E copy ${CMAKE_CURRENT_SOURCE_DIR}/README.md ${CMAKE_CURRENT_BINARY_DIR}/README.md
    COMMAND ${CMAKE_COMMAND} -E copy ${CMAKE_CURRENT_SOURCE_DIR}/metadata.json ${CMAKE_CURRENT_BINARY_DIR}/metadata.json
    COMMAND ${CMAKE_COMMAND} -E copy ${CMAKE_CURRENT_SOURCE_DIR}/${PLUGIN_NAME}.py ${CMAKE_CURRENT_BINARY_DIR}/${PLUGIN_NAME}.py
    DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/README.md
    DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/metadata.json
    DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/${PLUGIN_NAME}.py
    COMMENT "[${PLUGIN_NAME}] Copying README and metadata files..."
    VERBATIM
)
add_custom_target(
    ${PLUGIN_NAME} ALL
    DEPENDS ${CMAKE_CURRENT_BINARY_DIR}/README.md
    DEPENDS ${CMAKE_CURRENT_BINARY_DIR}/metadata.json
    DEPENDS ${CMAKE_CURRENT_BINARY_DIR}/${PLUGIN_NAME}.py
)

add_dependencies(${PLUGIN_NAME} generate_lvtclp_plugin_headers)
